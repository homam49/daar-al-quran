@extends('layouts.student')

@section('title', 'ŸÖÿ™ÿßÿ®ÿπÿ© ÿ≠ŸÅÿ∏ ÿßŸÑŸÇÿ±ÿ¢ŸÜ')

@section('student-content')
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4>ÿ™ÿ™ÿ®ÿπ ÿ≠ŸÅÿ∏ ÿßŸÑŸÇÿ±ÿ¢ŸÜ - {{ $student->full_name }}</h4>
                    <a href="{{ route('student.dashboard') }}" class="btn btn-secondary">
                        <i class="fa fa-arrow-right"></i> ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ
                    </a>
                </div>

                <div class="card-body">
                    <!-- Pages and Surahs Statistics -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card border-info">
                                <div class="card-header bg-info text-white">
                                    <h6 class="mb-0">ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿµŸÅÿ≠ÿßÿ™ (1-581)</h6>
                                </div>
                                <div class="card-body">
                                    <div class="row text-center">
                                        <div class="col-4">
                                            <h5 class="text-info">{{ $statistics['pages']['total'] }}</h5>
                                            <small>ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿµŸÅÿ≠ÿßÿ™</small>
                                        </div>
                                        <div class="col-4">
                                            <h5 class="text-success">{{ $statistics['pages']['memorized'] }}</h5>
                                            <small>ŸÖÿ≠ŸÅŸàÿ∏ÿ©</small>
                                        </div>
                                        <div class="col-4">
                                            <h5 class="text-warning">{{ $statistics['pages']['in_progress'] }}</h5>
                                            <small>ŸÇŸäÿØ ÿßŸÑÿ≠ŸÅÿ∏</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-success">
                                <div class="card-header bg-success text-white">
                                    <h6 class="mb-0">ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿ≥Ÿàÿ± (78-114)</h6>
                                </div>
                                <div class="card-body">
                                    <div class="row text-center">
                                        <div class="col-4">
                                            <h5 class="text-success">{{ $statistics['surahs']['total'] }}</h5>
                                            <small>ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ≥Ÿàÿ±</small>
                                        </div>
                                        <div class="col-4">
                                            <h5 class="text-success">{{ $statistics['surahs']['memorized'] }}</h5>
                                            <small>ŸÖÿ≠ŸÅŸàÿ∏ÿ©</small>
                                        </div>
                                        <div class="col-4">
                                            <h5 class="text-warning">{{ $statistics['surahs']['in_progress'] }}</h5>
                                            <small>ŸÇŸäÿØ ÿßŸÑÿ≠ŸÅÿ∏</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation Tabs -->
                    <ul class="nav nav-tabs" id="memorizationTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="pages-tab" data-bs-toggle="tab" data-bs-target="#pages" type="button" role="tab" style="color: #495057 !important; background-color: white !important; border: 1px solid #dee2e6 !important;">
                                <i class="fa fa-file-text" style="color: inherit !important;"></i> ÿßŸÑÿµŸÅÿ≠ÿßÿ™ (1-581)
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="surahs-tab" data-bs-toggle="tab" data-bs-target="#surahs" type="button" role="tab" style="color: #495057 !important; background-color: white !important; border: 1px solid #dee2e6 !important;">
                                <i class="fa fa-book" style="color: inherit !important;"></i> ÿßŸÑÿ≥Ÿàÿ± ÿßŸÑÿ£ÿÆŸäÿ±ÿ© (78-114)
                            </button>
                        </li>
                    </ul>

                    <!-- Tab Content -->
                    <div class="tab-content" id="memorizationTabContent">
                        <!-- Pages Tab -->
                        <div class="tab-pane fade show active" id="pages" role="tabpanel">
                            <div class="mt-3">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h5>ÿµŸÅÿ≠ÿßÿ™ ÿßŸÑŸÇÿ±ÿ¢ŸÜ ÿßŸÑŸÉÿ±ŸäŸÖ (1-581)</h5>
                                    <div class="alert alert-info mb-0" role="alert">
                                        <small><i class="fa fa-info-circle"></i> ÿßŸÜŸÇÿ± ÿπŸÑŸâ ÿ£Ÿä ÿµŸÅÿ≠ÿ© ŸÑÿπÿ±ÿ∂ ÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ (ÿ•ŸÜ Ÿàÿ¨ÿØÿ™)</small>
                                    </div>
                                </div>
                                
                                <!-- Status Legend -->
                                <div class="mb-3 p-2 bg-light rounded">
                                    <div class="d-flex justify-content-center gap-4">
                                        <span class="d-flex align-items-center gap-1">
                                            <div class="legend-box bg-light border"></div>
                                            <small>ŸÑŸÖ Ÿäÿ®ÿØÿ£</small>
                                        </span>
                                        <span class="d-flex align-items-center gap-1">
                                            <div class="legend-box bg-warning"></div>
                                            <small>ŸÇŸäÿØ ÿßŸÑÿ≠ŸÅÿ∏</small>
                                        </span>
                                        <span class="d-flex align-items-center gap-1">
                                            <div class="legend-box bg-success"></div>
                                            <small>ŸÖÿ≠ŸÅŸàÿ∏</small>
                                        </span>
                                    </div>
                                </div>
                                
                                <!-- Pages Grid -->
                                <div class="pages-grid" style="max-height: 600px; overflow-y: auto;">
                                    <div class="row">
                                        @for($page = 1; $page <= 581; $page++)
                                            @php
                                                $pageId = "page_{$page}";
                                                $progress = $progressLookup[$pageId] ?? null;
                                                $status = $progress ? $progress->status : 'not_started';
                                                $hasNotes = $progress && !empty($progress->notes);
                                                switch($status) {
                                                    case 'memorized':
                                                        $statusClass = 'bg-success text-white';
                                                        break;
                                                    case 'in_progress':
                                                        $statusClass = 'bg-warning text-dark';
                                                        break;
                                                    default:
                                                        $statusClass = 'bg-light border';
                                                        break;
                                                }
                                                if ($hasNotes) {
                                                    $statusClass .= ' has-notes';
                                                }
                                            @endphp
                                            <div class="col-lg-1 col-md-2 col-sm-3 col-4 mb-2">
                                                <div class="card content-card {{ $statusClass }} h-100 cursor-pointer" 
                                                     data-type="page" 
                                                     data-number="{{ $page }}" 
                                                     data-name="ÿµŸÅÿ≠ÿ© {{ $page }}"
                                                     data-current-status="{{ $status }}"
                                                     onclick="showProgressInfo('page', {{ $page }}, 'ÿµŸÅÿ≠ÿ© {{ $page }}')">
                                                    <div class="card-body p-2 text-center">
                                                        <div class="small">{{ $page }}</div>
                                                        @if($hasNotes)
                                                            <div class="small">üìù</div>
                                                        @endif
                                                    </div>
                                                </div>
                                            </div>
                                        @endfor
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Surahs Tab -->
                        <div class="tab-pane fade" id="surahs" role="tabpanel">
                            <div class="mt-3">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h5>ÿßŸÑÿ≥Ÿàÿ± ÿßŸÑÿ£ÿÆŸäÿ±ÿ© (78-114)</h5>
                                    <div class="alert alert-info mb-0" role="alert">
                                        <small><i class="fa fa-info-circle"></i> ÿßŸÜŸÇÿ± ÿπŸÑŸâ ÿ£Ÿä ÿ≥Ÿàÿ±ÿ© ŸÑÿπÿ±ÿ∂ ÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ (ÿ•ŸÜ Ÿàÿ¨ÿØÿ™)</small>
                                    </div>
                                </div>
                                
                                <!-- Status Legend -->
                                <div class="mb-3 p-2 bg-light rounded">
                                    <div class="d-flex justify-content-center gap-4">
                                        <span class="d-flex align-items-center gap-1">
                                            <div class="legend-box bg-light border"></div>
                                            <small>ŸÑŸÖ Ÿäÿ®ÿØÿ£</small>
                                        </span>
                                        <span class="d-flex align-items-center gap-1">
                                            <div class="legend-box bg-warning"></div>
                                            <small>ŸÇŸäÿØ ÿßŸÑÿ≠ŸÅÿ∏</small>
                                        </span>
                                        <span class="d-flex align-items-center gap-1">
                                            <div class="legend-box bg-success"></div>
                                            <small>ŸÖÿ≠ŸÅŸàÿ∏</small>
                                        </span>
                                    </div>
                                </div>

                                <!-- Surahs Grid -->
                                <div class="surahs-grid" style="max-height: 600px; overflow-y: auto;">
                                    <div class="row">
                                        @php
                                            $surahNames = [
                                                78 => 'ÿßŸÑŸÜÿ®ÿ£', 79 => 'ÿßŸÑŸÜÿßÿ≤ÿπÿßÿ™', 80 => 'ÿπÿ®ÿ≥', 81 => 'ÿßŸÑÿ™ŸÉŸàŸäÿ±', 82 => 'ÿßŸÑÿßŸÜŸÅÿ∑ÿßÿ±',
                                                83 => 'ÿßŸÑŸÖÿ∑ŸÅŸÅŸäŸÜ', 84 => 'ÿßŸÑÿßŸÜÿ¥ŸÇÿßŸÇ', 85 => 'ÿßŸÑÿ®ÿ±Ÿàÿ¨', 86 => 'ÿßŸÑÿ∑ÿßÿ±ŸÇ', 87 => 'ÿßŸÑÿ£ÿπŸÑŸâ',
                                                88 => 'ÿßŸÑÿ∫ÿßÿ¥Ÿäÿ©', 89 => 'ÿßŸÑŸÅÿ¨ÿ±', 90 => 'ÿßŸÑÿ®ŸÑÿØ', 91 => 'ÿßŸÑÿ¥ŸÖÿ≥', 92 => 'ÿßŸÑŸÑŸäŸÑ',
                                                93 => 'ÿßŸÑÿ∂ÿ≠Ÿâ', 94 => 'ÿßŸÑÿ¥ÿ±ÿ≠', 95 => 'ÿßŸÑÿ™ŸäŸÜ', 96 => 'ÿßŸÑÿπŸÑŸÇ', 97 => 'ÿßŸÑŸÇÿØÿ±',
                                                98 => 'ÿßŸÑÿ®ŸäŸÜÿ©', 99 => 'ÿßŸÑÿ≤ŸÑÿ≤ŸÑÿ©', 100 => 'ÿßŸÑÿπÿßÿØŸäÿßÿ™', 101 => 'ÿßŸÑŸÇÿßÿ±ÿπÿ©', 102 => 'ÿßŸÑÿ™ŸÉÿßÿ´ÿ±',
                                                103 => 'ÿßŸÑÿπÿµÿ±', 104 => 'ÿßŸÑŸáŸÖÿ≤ÿ©', 105 => 'ÿßŸÑŸÅŸäŸÑ', 106 => 'ŸÇÿ±Ÿäÿ¥', 107 => 'ÿßŸÑŸÖÿßÿπŸàŸÜ',
                                                108 => 'ÿßŸÑŸÉŸàÿ´ÿ±', 109 => 'ÿßŸÑŸÉÿßŸÅÿ±ŸàŸÜ', 110 => 'ÿßŸÑŸÜÿµÿ±', 111 => 'ÿßŸÑŸÖÿ≥ÿØ', 112 => 'ÿßŸÑÿ•ÿÆŸÑÿßÿµ',
                                                113 => 'ÿßŸÑŸÅŸÑŸÇ', 114 => 'ÿßŸÑŸÜÿßÿ≥'
                                            ];
                                        @endphp
                                        @for($surah = 78; $surah <= 114; $surah++)
                                            @php
                                                $surahId = "surah_{$surah}";
                                                $progress = $progressLookup[$surahId] ?? null;
                                                $status = $progress ? $progress->status : 'not_started';
                                                $hasNotes = $progress && !empty($progress->notes);
                                                $surahName = $surahNames[$surah];
                                                switch($status) {
                                                    case 'memorized':
                                                        $statusClass = 'bg-success text-white';
                                                        break;
                                                    case 'in_progress':
                                                        $statusClass = 'bg-warning text-dark';
                                                        break;
                                                    default:
                                                        $statusClass = 'bg-light border';
                                                        break;
                                                }
                                                if ($hasNotes) {
                                                    $statusClass .= ' has-notes';
                                                }
                                            @endphp
                                            <div class="col-lg-3 col-md-4 col-sm-6 mb-2">
                                                <div class="card content-card {{ $statusClass }} h-100 cursor-pointer" 
                                                     data-type="surah" 
                                                     data-number="{{ $surah }}" 
                                                     data-name="{{ $surahName }}"
                                                     data-current-status="{{ $status }}"
                                                     onclick="showProgressInfo('surah', {{ $surah }}, '{{ $surahName }}')">
                                                    <div class="card-body p-2">
                                                        <div class="small fw-bold">{{ $surah }}. {{ $surahName }}</div>
                                                        @if($hasNotes)
                                                            <div class="text-center mt-1">üìù</div>
                                                        @endif
                                                    </div>
                                                </div>
                                            </div>
                                        @endfor
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Progress Info Modal -->
<div class="modal fade" id="progressInfoModal" tabindex="-1" aria-labelledby="progressInfoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="progressInfoModalLabel">ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ≠ŸÅÿ∏</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row mb-3">
                    <div class="col-4"><strong>ÿßŸÑÿπŸÜÿµÿ±:</strong></div>
                    <div class="col-8" id="modalContentName"></div>
                </div>
                <div class="row mb-3">
                    <div class="col-4"><strong>ÿßŸÑÿ≠ÿßŸÑÿ©:</strong></div>
                    <div class="col-8" id="modalStatus"></div>
                </div>

                <div class="row mb-3" id="modalStartedRow" style="display: none;">
                    <div class="col-4"><strong>ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ®ÿØÿ°:</strong></div>
                    <div class="col-8" id="modalStarted"></div>
                </div>
                <div class="row mb-3" id="modalCompletedRow" style="display: none;">
                    <div class="col-4"><strong>ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ•ÿ™ŸÖÿßŸÖ:</strong></div>
                    <div class="col-8" id="modalCompleted"></div>
                </div>
                <div class="row mb-3" id="modalNotesRow" style="display: none;">
                    <div class="col-4"><strong>ÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™:</strong></div>
                    <div class="col-8" id="modalNotes"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ÿ•ÿ∫ŸÑÿßŸÇ</button>
            </div>
        </div>
    </div>
</div>

<style>
.legend-box {
    width: 15px;
    height: 15px;
    border-radius: 3px;
    display: inline-block;
}

.content-card {
    transition: all 0.2s ease;
    min-height: 50px;
}

.content-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.content-card.has-notes {
    position: relative;
}

.content-card.has-notes::after {
    content: '';
    position: absolute;
    top: 5px;
    right: 5px;
    width: 8px;
    height: 8px;
    background-color: #007bff;
    border-radius: 50%;
}

.cursor-pointer {
    cursor: pointer;
}

/* Tab styling improvements */
.nav-tabs .nav-link {
    color: #495057 !important;
    background-color: white !important;
    border: 1px solid #dee2e6 !important;
}

.nav-tabs .nav-link.active {
    background-color: #f8f9fa !important;
    border-bottom-color: transparent !important;
}
</style>

<script>
function showProgressInfo(type, number, name) {
    // Fetch progress information via AJAX
    fetch(`{{ url('/student/memorization') }}/${type}/${number}`)
        .then(response => response.json())
        .then(data => {
            // Update modal content
            document.getElementById('modalContentName').textContent = name;
            
            // Update status
            let statusText = '';
            let statusClass = '';
            switch(data.status) {
                case 'memorized':
                    statusText = 'ŸÖÿ≠ŸÅŸàÿ∏';
                    statusClass = 'badge bg-success';
                    break;
                case 'in_progress':
                    statusText = 'ŸÇŸäÿØ ÿßŸÑÿ≠ŸÅÿ∏';
                    statusClass = 'badge bg-warning text-dark';
                    break;
                default:
                    statusText = 'ŸÑŸÖ Ÿäÿ®ÿØÿ£';
                    statusClass = 'badge bg-light text-dark';
                    break;
            }
            document.getElementById('modalStatus').innerHTML = `<span class="${statusClass}">${statusText}</span>`;
            

            
            // Show/hide and update started date
            if (data.started_at) {
                document.getElementById('modalStarted').textContent = data.started_at;
                document.getElementById('modalStartedRow').style.display = 'flex';
            } else {
                document.getElementById('modalStartedRow').style.display = 'none';
            }
            
            // Show/hide and update completed date
            if (data.completed_at) {
                document.getElementById('modalCompleted').textContent = data.completed_at;
                document.getElementById('modalCompletedRow').style.display = 'flex';
            } else {
                document.getElementById('modalCompletedRow').style.display = 'none';
            }
            
            // Show/hide and update notes
            if (data.notes && data.notes.trim() !== '') {
                document.getElementById('modalNotes').textContent = data.notes;
                document.getElementById('modalNotesRow').style.display = 'flex';
            } else {
                document.getElementById('modalNotesRow').style.display = 'none';
            }
            
            // Show the modal
            new bootstrap.Modal(document.getElementById('progressInfoModal')).show();
        })
        .catch(error => {
            console.error('Error fetching progress:', error);
            alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™');
        });
}
</script>
@endsection 